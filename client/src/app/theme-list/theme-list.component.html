<div class="container">
  <h3>–í—Å–∏—á–∫–∏ —Ä–µ—Ü–µ–ø—Ç–∏</h3>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ä–µ—Ü–µ–ø—Ç–∏—Ç–µ...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="hasError" class="error">
    <p>{{ errorMessage }}</p>
    <button (click)="retryLoad()" class="btn btn-primary">
      –û–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ
    </button>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading && !hasError">
    <!-- Sorting Controls -->
    <div class="sorting-controls">
      <label for="sort-select">–°–æ—Ä—Ç–∏—Ä–∞–π –ø–æ:</label>
      <select id="sort-select" [(ngModel)]="selectedSort" (change)="sortThemes()">
        <option value="newest">–ù–∞–π-–Ω–æ–≤–∏</option>
        <option value="oldest">–ù–∞–π-—Å—Ç–∞—Ä–∏</option>
        <option value="rating-high">–†–µ–π—Ç–∏–Ω–≥ (–Ω–∞–π-–≤–∏—Å–æ–∫)</option>
        <option value="rating-low">–†–µ–π—Ç–∏–Ω–≥ (–Ω–∞–π-–Ω–∏—Å—ä–∫)</option>
        <option value="title">–ó–∞–≥–ª–∞–≤–∏–µ (–ê-–Ø)</option>
        <option value="title-reverse">–ó–∞–≥–ª–∞–≤–∏–µ (–Ø-–ê)</option>
        <option value="time">–í—Ä–µ–º–µ –∑–∞ –ø—Ä–∏–≥–æ—Ç–≤—è–Ω–µ (–Ω–∞–π-–±—ä—Ä–∑–∏)</option>
        <option value="time-reverse">–í—Ä–µ–º–µ –∑–∞ –ø—Ä–∏–≥–æ—Ç–≤—è–Ω–µ (–Ω–∞–π-–±–∞–≤–Ω–∏)</option>
        <option value="calories-low">üî• –ö–∞–ª–æ—Ä–∏–∏ (–Ω–∞–π-–º–∞–ª–∫–æ)</option>
        <option value="calories-high">üî• –ö–∞–ª–æ—Ä–∏–∏ (–Ω–∞–π-–º–Ω–æ–≥–æ)</option>
        <option value="protein-high">üí™ –ü—Ä–æ—Ç–µ–∏–Ω–∏ (–Ω–∞–π-–º–Ω–æ–≥–æ)</option>
        <option value="protein-low">üí™ –ü—Ä–æ—Ç–µ–∏–Ω–∏ (–Ω–∞–π-–º–∞–ª–∫–æ)</option>
        <option value="carbs-low">üçû –í—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–∏ (–Ω–∞–π-–º–∞–ª–∫–æ)</option>
        <option value="carbs-high">üçû –í—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–∏ (–Ω–∞–π-–º–Ω–æ–≥–æ)</option>
        <option value="fats-low">ü•ë –ú–∞–∑–Ω–∏–Ω–∏ (–Ω–∞–π-–º–∞–ª–∫–æ)</option>
        <option value="fats-high">ü•ë –ú–∞–∑–Ω–∏–Ω–∏ (–Ω–∞–π-–º–Ω–æ–≥–æ)</option>
      </select>
    </div>

    <!-- No Themes Message -->
    <div *ngIf="themesList.length === 0" class="error">
      <p>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ —Ä–µ—Ü–µ–ø—Ç–∏.</p>
    </div>

    <!-- Themes List -->
    <ul class="cards" *ngIf="themesList && themesList.length > 0">
      <li class="card" *ngFor="let post of themesList; trackBy: trackByThemeId">
        <!-- Favorite Button -->
        <div class="favorite-button" *ngIf="isLogged && post._id">
          <button (click)="toggleFavorite(post._id)" class="favorite-btn" [class.favorited]="isFavorite(post._id)"
            [title]="isFavorite(post._id) ? '–ü—Ä–µ–º–∞—Ö–Ω–∏ –æ—Ç –ª—é–±–∏–º–∏' : '–î–æ–±–∞–≤–∏ –≤ –ª—é–±–∏–º–∏'">
            {{ isFavorite(post._id) ? '‚ù§Ô∏è' : 'ü§ç' }}
          </button>
        </div>

        <img [src]="post.img || 'assets/logo.jpg'" [alt]="(post.title || 'Recipe') | uppercase"
          (error)="onImageError($event)" onerror="this.onerror=null; this.src='assets/logo.jpg';" loading="lazy" />
        <h6>{{ post.title || '–ë–µ–∑ –∑–∞–≥–ª–∞–≤–∏–µ' }}</h6>
        <span class="created">
          –ü—É–±–ª–∏–∫—É–≤–∞–Ω–∞: {{ (post.created_at || defaultDate) | date:'dd.MM.y' }}
        </span>
        <p class="time">
          <span class="material-symbols-outlined">schedule</span>
          –í—Ä–µ–º–µ –Ω–∞ –ø—Ä–∏–≥–æ—Ç–≤—è–Ω–µ –≤ –º–∏–Ω—É—Ç–∏: {{ post.time || 0 }}
        </p>

        <!-- Nutritional Information Display -->
        <div class="nutritional-info" *ngIf="hasNutritionalInfo(post)">
          <h4>ü•ó –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
          <div class="nutritional-grid">
            <div class="nutrition-item" *ngIf="post.calories">
              <span class="nutrition-icon">üî•</span>
              <span class="nutrition-value">{{ post.calories }} kcal</span>
            </div>
            <div class="nutrition-item" *ngIf="post.protein">
              <span class="nutrition-icon">üí™</span>
              <span class="nutrition-value">{{ post.protein }}g –ø—Ä–æ—Ç–µ–∏–Ω–∏</span>
            </div>
            <div class="nutrition-item" *ngIf="post.fats">
              <span class="nutrition-icon">ü•ë</span>
              <span class="nutrition-value">{{ post.fats }}g –º–∞–∑–Ω–∏–Ω–∏</span>
            </div>
            <div class="nutrition-item" *ngIf="post.carbs">
              <span class="nutrition-icon">üçû</span>
              <span class="nutrition-value">{{ post.carbs }}g –≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–∏</span>
            </div>
          </div>
        </div>

        <!-- Rating Display -->
        <div class="rating-display">
          <span class="rating-text">–†–µ–π—Ç–∏–Ω–≥: {{ (post.averageRating || 0) | number:'1.1-1' }} / 5</span>
          <div class="stars-display">
            <span *ngFor="let star of [1,2,3,4,5]" class="star {{ getStarClass(post.averageRating || 0, star) }}">
              ‚òÖ
            </span>
          </div>
          <span class="rating-count">({{ post.totalRatings || 0 }} –æ—Ü–µ–Ω–∫–∏)</span>
        </div>

        <!-- Like/Dislike Buttons -->
        <div class="like-dislike-section" *ngIf="isLogged && post._id">
          <div class="like-dislike-buttons">
            <button class="action-btn like-btn" [class.active]="hasUserLiked(post._id)"
              (click)="likeRecipe(post._id, 'like')"
              [title]="hasUserLiked(post._id) ? '–ü—Ä–µ–º–∞—Ö–Ω–∏ —Ö–∞—Ä–µ—Å–≤–∞–Ω–µ—Ç–æ' : '–•–∞—Ä–µ—Å–∞–π'">
              <span class="material-symbols-outlined">thumb_up</span>
              <span class="count">{{ getLikeCount(post) }}</span>
            </button>

            <button class="action-btn dislike-btn" [class.active]="hasUserDisliked(post._id)"
              (click)="likeRecipe(post._id, 'dislike')"
              [title]="hasUserDisliked(post._id) ? '–ü—Ä–µ–º–∞—Ö–Ω–∏ –Ω–µ—Ö–∞—Ä–µ—Å–≤–∞–Ω–µ—Ç–æ' : '–ù–µ —Ö–∞—Ä–µ—Å–∞–π'">
              <span class="material-symbols-outlined">thumb_down</span>
              <span class="count">{{ getDislikeCount(post) }}</span>
            </button>
          </div>
        </div>

        <p>–°—ä—Å—Ç–∞–≤–∫–∏: {{ post.ingredients || '–ù—è–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Å—ä—Å—Ç–∞–≤–∫–∏—Ç–µ' }}</p>
        <p>–ù–∞—á–∏–Ω –Ω–∞ –ø—Ä–∏–≥–æ—Ç–≤—è–Ω–µ: {{ post.text || '–ù—è–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –Ω–∞—á–∏–Ω–∞ –Ω–∞ –ø—Ä–∏–≥–æ—Ç–≤—è–Ω–µ' }}</p>
        <a [routerLink]="['/theme', post._id]" *ngIf="post._id">–í–∏–∂—Ç–µ —Ü—è–ª–∞—Ç–∞ —Ä–µ—Ü–µ–ø—Ç–∞...</a>
      </li>
    </ul>
  </div>
</div>