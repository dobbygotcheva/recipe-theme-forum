<div class="profile-management">
  <!-- Profile Summary Section -->
  <div class="profile-summary-section" *ngIf="!isEditing && !isChangingPassword">
    <h3>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∞</h3>

    <div class="profile-summary" *ngIf="user">
      <!-- Avatar Display -->
      <div class="avatar-display">
        <img [src]="getAvatarUrl()" alt="Profile Avatar" class="profile-avatar" />
        <div class="avatar-info">
          <h4>{{ user.username }}</h4>
          <p>{{ user.email }}</p>
        </div>
      </div>

      <div class="summary-info">
        <div class="info-item">
          <span class="label">üë§ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ:</span>
          <span class="value">{{ user.username || '–ù–µ –µ –∑–∞–¥–∞–¥–µ–Ω–æ' }}</span>
        </div>
        <div class="info-item">
          <span class="label">üìß Email:</span>
          <span class="value">{{ user.email || '–ù–µ –µ –∑–∞–¥–∞–¥–µ–Ω–æ' }}</span>
        </div>
        <div class="info-item">
          <span class="label">üìù –ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</span>
          <span class="value">{{ user.bio || '–ù–µ –µ –∑–∞–¥–∞–¥–µ–Ω–æ' }}</span>
        </div>
        <div class="info-item">
          <span class="label">üì± –¢–µ–ª–µ—Ñ–æ–Ω:</span>
          <span class="value">{{ user.phone || '–ù–µ –µ –∑–∞–¥–∞–¥–µ–Ω–æ' }}</span>
        </div>
      </div>

      <div class="profile-actions">
        <button (click)="toggleEdit()" class="action-btn edit-btn">
          ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π –ø—Ä–æ—Ñ–∏–ª
        </button>
        <button (click)="togglePasswordChange()" class="action-btn password-btn">
          üîê –°–º–µ–Ω–∏ –ø–∞—Ä–æ–ª–∞
        </button>
      </div>
    </div>


  </div>

  <!-- Profile Edit Form -->
  <div class="profile-edit-section" *ngIf="isEditing">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª</h3>
    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="profile-form">
      <div class="form-group">
        <label for="username">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ</label>
        <input type="text" id="username" formControlName="username" class="form-input"
          [class.error]="profileForm.get('username')?.invalid && profileForm.get('username')?.touched" />
        <div class="error-message" *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched">
          –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ—Ç–æ –∏–º–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –ø–æ–Ω–µ 2 —Å–∏–º–≤–æ–ª–∞
        </div>
      </div>

      <div class="form-group">
        <label for="email">–ò–º–µ–π–ª</label>
        <input type="email" id="email" formControlName="email" class="form-input"
          [class.error]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" />
        <div class="error-message" *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
          –ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ –≤–∞–ª–∏–¥–µ–Ω –∏–º–µ–π–ª
        </div>
      </div>

      <div class="form-group">
        <label for="bio">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</label>
        <textarea id="bio" formControlName="bio" class="form-textarea" placeholder="–†–∞–∑–∫–∞–∂–µ—Ç–µ –∑–∞ —Å–µ–±–µ —Å–∏..."
          rows="4"></textarea>
        <div class="char-count">
          {{ profileForm.get('bio')?.value?.length || 0 }}/500
        </div>
      </div>

      <div class="form-group">
        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input type="tel" id="phone" formControlName="phone" class="form-input" placeholder="+359 888 123 456" />
      </div>

      <!-- Preferences Section -->
      <div class="preferences-section">
        <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h4>

        <div formGroupName="preferences">
          <div class="preferences-group">
            <h5>–ò–∑–≤–µ—Å—Ç–∏—è</h5>
            <div formGroupName="notifications" class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="email" />
                <span class="checkmark"></span>
                –ò–º–µ–π–ª –∏–∑–≤–µ—Å—Ç–∏—è
              </label>
              <label class="checkbox-label">
                <input type="checkbox" formControlName="push" />
                <span class="checkmark"></span>
                Push –∏–∑–≤–µ—Å—Ç–∏—è
              </label>
            </div>
          </div>

          <div class="preferences-group">
            <h5>–ü–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç</h5>
            <div formGroupName="privacy" class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="profilePublic" />
                <span class="checkmark"></span>
                –ü—É–±–ª–∏—á–µ–Ω –ø—Ä–æ—Ñ–∏–ª
              </label>
              <label class="checkbox-label">
                <input type="checkbox" formControlName="showEmail" />
                <span class="checkmark"></span>
                –ü–æ–∫–∞–∂–∏ –∏–º–µ–π–ª
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="save-btn" [disabled]="!profileForm.valid">
          <span class="material-symbols-outlined">save</span>
          –ó–∞–ø–∞–∑–∏
        </button>
        <button type="button" class="cancel-btn" (click)="cancelEdit()">
          <span class="material-symbols-outlined">close</span>
          –û—Ç–∫–∞–∑
        </button>
      </div>
    </form>
  </div>

  <!-- Password Change Form -->
  <div class="password-change-section" *ngIf="isChangingPassword">
    <h3>–°–º—è–Ω–∞ –Ω–∞ –ø–∞—Ä–æ–ª–∞</h3>
    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="password-form">
      <div class="form-group">
        <label for="currentPassword">–¢–µ–∫—É—â–∞ –ø–∞—Ä–æ–ª–∞</label>
        <input type="password" id="currentPassword" formControlName="currentPassword" class="form-input"
          [class.error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched" />
        <div class="error-message"
          *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
          –ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–∫—É—â–∞—Ç–∞ –ø–∞—Ä–æ–ª–∞
        </div>
      </div>

      <div class="form-group">
        <label for="newPassword">–ù–æ–≤–∞ –ø–∞—Ä–æ–ª–∞</label>
        <input type="password" id="newPassword" formControlName="newPassword" class="form-input"
          [class.error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" />
        <div class="error-message"
          *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
          –ü–∞—Ä–æ–ª–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –ø–æ–Ω–µ 6 —Å–∏–º–≤–æ–ª–∞
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">–ü–æ—Ç–≤—ä—Ä–¥–∏ –Ω–æ–≤–∞ –ø–∞—Ä–æ–ª–∞</label>
        <input type="password" id="confirmPassword" formControlName="confirmPassword" class="form-input"
          [class.error]="passwordForm.errors?.['passwordMismatch']" />
        <div class="error-message" *ngIf="passwordForm.errors?.['passwordMismatch']">
          –ü–∞—Ä–æ–ª–∏—Ç–µ –Ω–µ —Å—ä–≤–ø–∞–¥–∞—Ç
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="save-btn" [disabled]="!passwordForm.valid || isChangingPasswordLoading">
          <span class="material-symbols-outlined" *ngIf="!isChangingPasswordLoading">lock_reset</span>
          <span class="loading-spinner-small" *ngIf="isChangingPasswordLoading"></span>
          {{ isChangingPasswordLoading ? '–°–º–µ–Ω—è —Å–µ...' : '–°–º–µ–Ω–∏ –ø–∞—Ä–æ–ª–∞' }}
        </button>
        <button type="button" class="cancel-btn" (click)="togglePasswordChange()"
          [disabled]="isChangingPasswordLoading">
          <span class="material-symbols-outlined">close</span>
          –û—Ç–∫–∞–∑
        </button>
      </div>
    </form>
  </div>

  <!-- Avatar Upload Section -->
  <div class="avatar-upload-section" *ngIf="isEditing">
    <h4>–ü—Ä–æ—Ñ–∏–ª–Ω–∞ —Å–Ω–∏–º–∫–∞</h4>
    <div class="file-upload">
      <input type="file" accept="image/*" (change)="onFileSelected($event)" id="avatar-input" class="file-input" />
      <label for="avatar-input" class="file-label">
        <span class="material-symbols-outlined">upload</span>
        –ò–∑–±–µ—Ä–∏ —Å–Ω–∏–º–∫–∞
      </label>
    </div>

    <div class="avatar-preview" *ngIf="previewUrl">
      <img [src]="previewUrl" alt="Preview" class="preview-image" />
      <div class="preview-actions">
        <button class="upload-btn" (click)="uploadAvatar()" [disabled]="isUploadingAvatar">
          <span class="material-symbols-outlined">check</span>
          –ö–∞—á–∏
        </button>
        <button class="cancel-btn" (click)="cancelAvatarUpload()">
          <span class="material-symbols-outlined">close</span>
          –û—Ç–∫–∞–∑
        </button>
      </div>
    </div>
  </div>
</div>