<div class="search-container">
  <!-- Prominent Search Bar at Top -->
  <div class="search-header">
    <div class="search-bar-container">
      <div class="search-input-wrapper">
        <i class="search-icon">üîç</i>
        <input type="text" id="searchInput" [(ngModel)]="searchInput" (ngModelChange)="onSearchInputChange()"
          placeholder="–¢—ä—Ä—Å–µ—Ç–µ —Ä–µ—Ü–µ–ø—Ç–∏, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏, –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∏..." class="main-search-input" />
        <button *ngIf="searchInput" (click)="clearSearch()" class="clear-btn">
          ‚úï
        </button>
      </div>

      <!-- Search Type Selector -->
      <div class="search-type-selector">
        <button [class.active]="searchType === 'all'" (click)="searchType = 'all'; performSearch()"
          class="search-type-btn">
          üåü –í—Å–∏—á–∫–æ
        </button>
        <button [class.active]="searchType === 'recipes'" (click)="searchType = 'recipes'; performSearch()"
          class="search-type-btn">
          üç≥ –†–µ—Ü–µ–ø—Ç–∏
        </button>
        <button [class.active]="searchType === 'users'" (click)="searchType = 'users'; performSearch()"
          class="search-type-btn">
          üë• –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
        </button>
      </div>
    </div>

    <!-- Category Filter (only for recipes) -->
    <div class="category-filter" *ngIf="searchType === 'recipes' || searchType === 'all'">
      <label for="categorySelect">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
      <select id="categorySelect" [(ngModel)]="searchInput1" (ngModelChange)="onCategoryChange()"
        class="category-select">
        <option value="">–í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        <option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </option>
      </select>
    </div>
  </div>

  <!-- Search Results -->
  <div class="search-results" *ngIf="searchInput || searchInput1">

    <!-- Recipe Results -->
    <section class="recipe-results" *ngIf="searchType === 'recipes' || searchType === 'all'">
      <div class="results-header">
        <h3>üç≥ –†–µ—Ü–µ–ø—Ç–∏</h3>
        <span class="result-count">{{ filteredThemes.length }} —Ä–µ–∑—É–ª—Ç–∞—Ç–∞</span>
      </div>

      <!-- Sorting Controls -->
      <div class="sorting-controls" *ngIf="filteredThemes.length > 0">
        <label for="sort-select">üîÄ –°–æ—Ä—Ç–∏—Ä–∞–π –ø–æ:</label>
        <select id="sort-select" [(ngModel)]="selectedSort" (change)="sortThemes()" class="sort-select">
          <option value="newest">üìÖ –ù–∞–π-–Ω–æ–≤–∏</option>
          <option value="oldest">üìÖ –ù–∞–π-—Å—Ç–∞—Ä–∏</option>
          <option value="rating-high">‚≠ê –†–µ–π—Ç–∏–Ω–≥ (–Ω–∞–π-–≤–∏—Å–æ–∫)</option>
          <option value="rating-low">‚≠ê –†–µ–π—Ç–∏–Ω–≥ (–Ω–∞–π-–Ω–∏—Å—ä–∫)</option>
          <option value="title-az">üìù –ó–∞–≥–ª–∞–≤–∏–µ (–ê-–Ø)</option>
          <option value="title-za">üìù –ó–∞–≥–ª–∞–≤–∏–µ (–Ø-–ê)</option>
          <option value="time-low">‚è∞ –í—Ä–µ–º–µ (–Ω–∞–π-–±—ä—Ä–∑–∏)</option>
          <option value="time-high">‚è∞ –í—Ä–µ–º–µ (–Ω–∞–π-–±–∞–≤–Ω–∏)</option>
          <option value="calories-low">üî• –ö–∞–ª–æ—Ä–∏–∏ (–Ω–∞–π-–º–∞–ª–∫–æ)</option>
          <option value="calories-high">üî• –ö–∞–ª–æ—Ä–∏–∏ (–Ω–∞–π-–º–Ω–æ–≥–æ)</option>
          <option value="protein-high">üí™ –ü—Ä–æ—Ç–µ–∏–Ω–∏ (–Ω–∞–π-–º–Ω–æ–≥–æ)</option>
          <option value="carbs-low">üçû –í—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–∏ (–Ω–∞–π-–º–∞–ª–∫–æ)</option>
          <option value="fats-low">ü•ë –ú–∞–∑–Ω–∏–Ω–∏ (–Ω–∞–π-–º–∞–ª–∫–æ)</option>
        </select>
        <span class="current-sort">üîÄ –°–æ—Ä—Ç–∏—Ä–∞–Ω–æ –ø–æ: {{ getSortDisplayName() }}</span>
      </div>

      <div class="loading-state" *ngIf="loadingThemes">
        <div class="spinner"></div>
        <p>–¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ —Ä–µ—Ü–µ–ø—Ç–∏...</p>
      </div>

      <div class="no-results" *ngIf="!loadingThemes && filteredThemes.length === 0 && (searchInput || searchInput1)">
        <p>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ —Ä–µ—Ü–µ–ø—Ç–∏ –∑–∞ "{{ searchInput || searchInput1 }}"</p>
        <p>–û–ø–∏—Ç–∞–π—Ç–µ —Å –¥—Ä—É–≥–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è</p>
      </div>

      <div class="recipe-grid" *ngIf="!loadingThemes && filteredThemes.length > 0">
        <div class="recipe-card" *ngFor="let recipe of filteredThemes">
          <div class="recipe-image">
            <img [src]="recipe.img || 'assets/default-recipe.jpg'" [alt]="recipe.title"
              (error)="onImageError($event, 'assets/default-recipe.jpg')" />
          </div>
          <div class="recipe-info">
            <h4 class="recipe-title">{{ recipe.title }}</h4>
            <p class="recipe-description">
              {{ (recipe.ingredients || '').substring(0, 100) + ((recipe.ingredients || '').length > 100 ? '...' : '')
              }}
            </p>
            <div class="recipe-meta">
              <span class="recipe-category">{{ recipe.category }}</span>
              <span class="recipe-time">‚è±Ô∏è {{ recipe.time }} –º–∏–Ω</span>
            </div>

            <!-- Nutritional Information Display -->
            <div class="nutritional-info" *ngIf="hasNutritionalInfo(recipe)">
              <h4>ü•ó –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
              <div class="nutritional-grid">
                <div class="nutrition-item" *ngIf="recipe.calories">
                  <span class="nutrition-icon">üî•</span>
                  <span class="nutrition-value">{{ recipe.calories }} kcal</span>
                </div>
                <div class="nutrition-item" *ngIf="recipe.protein">
                  <span class="nutrition-icon">üí™</span>
                  <span class="nutrition-value">{{ recipe.protein }}g –ø—Ä–æ—Ç–µ–∏–Ω–∏</span>
                </div>
                <div class="nutrition-item" *ngIf="recipe.fats">
                  <span class="nutrition-icon">ü•ë</span>
                  <span class="nutrition-value">{{ recipe.fats }}g –º–∞–∑–Ω–∏–Ω–∏</span>
                </div>
                <div class="nutrition-item" *ngIf="recipe.carbs">
                  <span class="nutrition-icon">üçû</span>
                  <span class="nutrition-value">{{ recipe.carbs }}g –≤—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–∏</span>
                </div>
              </div>
            </div>

            <button (click)="viewRecipe(recipe._id)" class="view-recipe-btn">
              –í–∏–∂ —Ä–µ—Ü–µ–ø—Ç–∞—Ç–∞
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- User Results -->
    <section class="user-results" *ngIf="searchType === 'users' || searchType === 'all'">
      <div class="results-header">
        <h3>üë• –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</h3>
        <span class="result-count">{{ filteredUsers.length }} –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è</span>
      </div>

      <div class="loading-state" *ngIf="loadingUsers">
        <div class="spinner"></div>
        <p>–¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏...</p>
      </div>

      <div class="no-results" *ngIf="!loadingUsers && filteredUsers.length === 0 && searchInput">
        <p>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∑–∞ "{{ searchInput }}"</p>
        <p>–û–ø–∏—Ç–∞–π—Ç–µ —Å –¥—Ä—É–≥–æ –∏–º–µ –∏–ª–∏ –∫–ª—é—á–æ–≤–∞ –¥—É–º–∞</p>
      </div>

      <div class="user-grid" *ngIf="!loadingUsers && filteredUsers.length > 0">
        <div class="user-card" *ngFor="let user of filteredUsers">
          <div class="user-avatar">
            <img [src]="getAvatarUrl(user)" [alt]="user.username"
              (error)="onImageError($event, 'assets/default-avatar.png')" />
          </div>
          <div class="user-info">
            <h4 class="username">{{ user.username }}</h4>
            <p class="user-bio">{{ user.bio || '–ù—è–º–∞ –æ–ø–∏—Å–∞–Ω–∏–µ' }}</p>
            <div class="user-meta">
              <span class="user-role" [class]="'role-' + (user.role || 'user')">
                {{ getRoleText(user.role || 'user') }}
              </span>
              <span class="user-email" *ngIf="user.preferences?.privacy?.showEmail">
                {{ user.email }}
              </span>
            </div>
            <button (click)="viewUserProfile(user._id)" class="view-profile-btn">
              –í–∏–∂ –ø—Ä–æ—Ñ–∏–ª–∞
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Results Summary -->
    <div class="results-summary" *ngIf="searchType === 'all' && (searchInput || searchInput1)">
      <div class="summary-stats">
        <div class="stat-item">
          <span class="stat-label">–†–µ—Ü–µ–ø—Ç–∏:</span>
          <span class="stat-number">{{ filteredThemes.length }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏:</span>
          <span class="stat-number">{{ filteredUsers.length }}</span>
        </div>
        <div class="stat-item total">
          <span class="stat-label">–û–±—â–æ:</span>
          <span class="stat-number">{{ filteredThemes.length + filteredUsers.length }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Welcome Message (when no search) -->
  <div class="welcome-message" *ngIf="!searchInput && !searchInput1">
    <div class="welcome-content">
      <h2>üîç –î–æ–±—Ä–µ –¥–æ—à–ª–∏ –≤ —Ç—ä—Ä—Å–∞—á–∫–∞—Ç–∞!</h2>
      <p>–¢—ä—Ä—Å–µ—Ç–µ —Ä–µ—Ü–µ–ø—Ç–∏, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∏–ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∏ –∑–∞ –¥–∞ –æ—Ç–∫—Ä–∏–µ—Ç–µ –Ω–æ–≤–∏ –≤–∫—É—Å–æ–≤–µ</p>

      <div class="search-tips">
        <h3>üí° –°—ä–≤–µ—Ç–∏ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ:</h3>
        <ul>
          <li>–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ —Ä–µ—Ü–µ–ø—Ç–∞ –∏–ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</li>
          <li>–¢—ä—Ä—Å–µ—Ç–µ –ø–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ</li>
          <li>–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞ —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ</li>
          <li>–ö–æ–º–±–∏–Ω–∏—Ä–∞–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏</li>
        </ul>
      </div>

      <div class="popular-searches">
        <h3>üî• –ü–æ–ø—É–ª—è—Ä–Ω–∏ —Ç—ä—Ä—Å–µ–Ω–∏—è:</h3>
        <div class="popular-tags">
          <span class="tag" (click)="searchInput = '–ø–∏—Ü–∞'; performSearch()">–ü–∏—Ü–∞</span>
          <span class="tag" (click)="searchInput = '–ø–∞—Å—Ç–∞'; performSearch()">–ü–∞—Å—Ç–∞</span>
          <span class="tag" (click)="searchInput = '—Å–∞–ª–∞—Ç–∞'; performSearch()">–°–∞–ª–∞—Ç–∞</span>
          <span class="tag" (click)="searchInput = '–¥–µ—Å–µ—Ä—Ç'; performSearch()">–î–µ—Å–µ—Ä—Ç</span>
          <span class="tag" (click)="searchInput = '–≤–µ–≥–∞–Ω'; performSearch()">–í–µ–≥–∞–Ω</span>
        </div>
      </div>
    </div>
  </div>
</div>